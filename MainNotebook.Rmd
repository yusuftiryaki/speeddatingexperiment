---
title: "Speed Dating Experiment by DEGPG"
author: "Orkun, Ozgur, Yusuf"
output:
  html_document: default
  html_notebook: default
---


# Giriş
## Hikayemiz
Hızlı tempolu şehir hayatının dezavantajlarından biri de eş bulmak için gerekli vakit ve iletişim ortamının yaratılamaması olarak karşımıza çıkıyor.
Bu probleme çözüm olarak katılımcıların bir çok eş adayı ile hızlı bir şekilde tanışabileceği etkinliklerin düzenlendiğini görüyoruz.<br>
...<br>
...<br>
Bu incelememizde katılımcıların kendi kendilerini nasıl tanımladıklarını, diğer insanların değerlendirmesi ile karşılaştırıp kendi tanımlarının beğeni almada etkili olup olmadığını sorgulayacağız. 

## Veri kümesi
Veri kümesi 195 özellik barındırıyor
8368 gözlem var
278 Erkek
276 Kadın

# Veri Temizliği ve Ön Hazırlık
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=FALSE)
#kullanılacak paketler
if (!require("pacman")) install.packages("pacman")
  pacman::p_load("scales","ggplot2","dplyr","reshape2","grid","gridExtra","devtools","GGally")

if (!require(ggradar))
  devtools::install_github("ricardo-bion/ggradar", 
                          dependencies=TRUE)

if(!exists("IFDEF_DEGPG_UTILS"))
  source("Utils.R")

rawdat <- 
read.csv('./data/Speed Dating Data.csv', header = T, stringsAsFactors = F)
```

## Veri dönüşümleri
Cinsiyet factor tipine dönüştürüldü
```{r tranformations, echo = FALSE}
data.transformed <- rawdat
#Cinsiyeti daha okunur yapalım
data.transformed[rawdat$gender == 0,]$gender <- 'Female'
data.transformed[rawdat$gender == 1,]$gender <- 'Male'
data.transformed$gender <- as.factor(data.transformed$gender)
```

## Veri temizleme
Değerlendirmenin kimin için yapıldığı belli değilse analize girmemeli
```{r data clean, echo = FALSE}
#id yada partner id olmayanları çıkar
data.cleaned <-
data.transformed %>%
  filter(!pid == "NA" | !id =="NA")
```

## Veri ayıklama
Sadece kullanacağımız değerlerden yeni bir veri kümesi oluşturduk
```{r data selection, echo = FALSE}
#sadece kullanacağımız attribute'ları alalım
data.analyse <-
data.cleaned %>%
  select(iid,pid, gender, attr3_1, sinc3_1, intel3_1, fun3_1, amb3_1, attr5_1, sinc5_1, intel5_1, fun5_1, amb5_1, attr, sinc, intel, fun, amb, shar,attr_o, sinc_o, intel_o, fun_o, amb_o, shar_o,dec_o,dec)
# geçici tabloları temizleyelim
rm(data.transformed,data.cleaned)

```
# Analiz
## Katılımcılar kendilerini nasıl değerlendiriyor

```{r compile data, warning=FALSE}
data.others.yourself.partners <-
  data.analyse %>% 
  group_by(iid) %>% 
  summarise(
    Gender = first(gender),
    PositiveResponseScore = mean(dec_o, na.rm = TRUE),
    Attractive.Others = first(attr5_1), 
    Sincere.Others = first(sinc5_1), 
    Intelligent.Others = first(intel5_1), 
    Fun.Others = first(fun5_1), 
    Ambitious.Others = first(amb5_1), 
    Attractive.Yourself = first(attr3_1), 
    Sincere.Yourself = first(sinc3_1), 
    Intelligent.Yourself = first(intel3_1), 
    Fun.Yourself = first(fun3_1), 
    Ambitious.Yourself = first(amb3_1),
    Attractive.Partners = mean(attr_o, na.rm = TRUE), 
    Sincere.Partners = mean(sinc_o, na.rm = TRUE), 
    Intelligent.Partners = mean(intel_o, na.rm = TRUE), 
    Fun.Partners = mean(fun_o, na.rm = TRUE), 
    Ambitious.Partners = mean(amb_o, na.rm = TRUE))

GGally::ggpairs(data = data.others.yourself.partners)
```

```{r how  measure yourself, echo = FALSE}
data.measure.yourself.mean <-
  data.others.yourself.partners %>% 
  filter(!is.na(Attractive.Yourself)) %>%
  group_by(Gender) %>% 
  summarise(Attractive = mean(Attractive.Yourself), Sincere = mean(Sincere.Yourself), Intelligent = mean(Intelligent.Yourself), Fun = mean(Fun.Yourself), Ambitious = mean(Ambitious.Yourself))

plot.measure.yourself.mean.all <- ggradar(plot.data = data.measure.yourself.mean, grid.mid = 5, grid.max = 10, legend.title = "Gender", grid.label.size =3,axis.label.size=4 )
plot.measure.yourself.mean.all


plot.measure.yourself <- ggplot(data = data.others.yourself.partners) + coord_flip()

plot.measure.yourself.attractive <- plot.measure.yourself + geom_boxplot(mapping = aes(x = Gender, y = Attractive.Yourself)) + labs(y="Attractiveness", x ="Gender", title = "How Attractive Are You?")

plot.measure.yourself.ambitious <- plot.measure.yourself + geom_boxplot(mapping = aes(x = Gender, y = Ambitious.Yourself)) + labs(y="Ambitious", x ="Gender", title = "How Ambitious Are You?")

plot.measure.yourself.sincere <- plot.measure.yourself + geom_boxplot(mapping = aes(x = Gender, y = Sincere.Yourself)) + labs(y="Sincere", x ="Gender", title = "How Sincere Are You?")

plot.measure.yourself.intelligent <- plot.measure.yourself + geom_boxplot(mapping = aes(x = Gender, y = Intelligent.Yourself)) + labs(y="Intelligent", x ="Gender", title = "How Intelligence Are You?")


plot.measure.yourself.fun <- plot.measure.yourself + geom_boxplot(mapping = aes(x = Gender, y = Fun.Yourself)) + labs(y="Fun", x ="Gender", title = "How Fun Are You?")


grid.arrange(plot.measure.yourself.attractive, plot.measure.yourself.ambitious, plot.measure.yourself.sincere, plot.measure.yourself.intelligent, plot.measure.yourself.fun, ncol = 1)

#median daha açıklayıcı
data.measure.yourself.median <-
  data.others.yourself.partners %>% 
  filter(!is.na(Attractive.Yourself)) %>%
  group_by(Gender) %>% 
  summarise(Attractive = median(Attractive.Yourself), Sincere = median(Sincere.Yourself), Intelligent = median(Intelligent.Yourself), Fun = median(Fun.Yourself), Ambitious = median(Ambitious.Yourself)) 
plot.measure.yourself.median.all <- ggradar(plot.data = data.measure.yourself.median, grid.mid = 5, grid.max = 10, legend.title = "Gender", grid.label.size =3,axis.label.size=4 )
plot.measure.yourself.median.all

```

## Katılımcılar kendilerinin nasıl değerlendirileceğini düşünüyor

```{r how  other percieve, echo = FALSE}
data.other.percieve.mean <-
  data.others.yourself.partners %>% 
  filter(!is.na(Attractive.Others)) %>%
  group_by(Gender) %>% 
  summarise(Attractive = mean(Attractive.Others), Sincere = mean(Sincere.Others), Intelligent = mean(Intelligent.Others), Fun = mean(Fun.Others), Ambitious = mean(Ambitious.Others))

plot.other.percieve.mean.all <- ggradar(plot.data = data.other.percieve.mean, grid.mid = 5, grid.max = 10, legend.title = "Gender", grid.label.size =3,axis.label.size=4)
plot.other.percieve.mean.all

plot.other.percieve <- ggplot(data = data.others.yourself.partners) +  coord_flip()

plot.other.percieve.attractive <- plot.other.percieve + geom_boxplot(mapping = aes(x = Gender, y = Attractive.Others)) + labs(y="Attractiveness", x ="Gender", title = "How Attractive Are You By Others?")

plot.other.percieve.ambitious <- plot.other.percieve + geom_boxplot(mapping = aes(x = Gender, y = Ambitious.Others)) + labs(y="Ambitious", x ="Gender", title = "How Ambitious Are You By Others?")

plot.other.percieve.sincere <- plot.other.percieve + geom_boxplot(mapping = aes(x = Gender, y = Sincere.Others)) + labs(y="Sincere", x ="Gender", title = "How Sincere Are You By Others?")

plot.other.percieve.intelligent <- plot.other.percieve + geom_boxplot(mapping = aes(x = Gender, y = Intelligent.Others)) + labs(y="Intelligent", x ="Gender", title = "How Intelligence Are You By Others?")

plot.other.percieve.fun <-plot.other.percieve + geom_boxplot(mapping = aes(x = Gender, y = Fun.Others)) + labs(y="Fun", x ="Gender", title = "How Fun Are You By Others?")

grid.arrange(plot.other.percieve.attractive, plot.other.percieve.ambitious, plot.other.percieve.sincere, plot.other.percieve.intelligent, plot.other.percieve.fun, ncol = 1 )

# median mean'den daha açıklayıcı görünüyor
data.other.percieve.median <-
  data.others.yourself.partners %>% 
  filter(!is.na(Attractive.Others)) %>%
  group_by(Gender) %>% 
  summarise(Attractive = median(Attractive.Others), Sincere = median(Sincere.Others), Intelligent = median(Intelligent.Others), Fun = median(Fun.Others), Ambitious = median(Ambitious.Others))

plot.other.percieve.median.all <- ggradar(plot.data = data.other.percieve.median, grid.mid = 5, grid.max = 10, legend.title = "Gender", grid.label.size =3,axis.label.size=4)
plot.other.percieve.median.all

```

## Göründüğümüz gibi olduğumuzu mu düşünüyoruz?
```{r are we same test, echo = TRUE}
#measure yourself and other percieve sorularını cevaplayanlar
data.others.yourself <-
  data.others.yourself.partners %>% 
  filter(!is.na(Attractive.Others)&!is.na(Attractive.Yourself))



plot.others.yourself <- ggplot(data = data.others.yourself) + geom_jitter(alpha = 0.2) + geom_smooth(method = "lm") + scale_x_continuous(breaks = seq(0,10,1)) + theme(panel.background = element_blank())
#aynı populasyon mu için t-paiared test
t.test(data.others.yourself$Attractive.Yourself, data.others.yourself$Attractive.Others, paired=TRUE) -> t.others.yourself.attractive
t.others.yourself.attractive
cor.test(data = data.others.yourself, ~Attractive.Yourself+Attractive.Others) -> cor.others.yourself.attractive
cor.others.yourself.attractive
plot.others.yourself.attractive <- plot.others.yourself + aes(x = Attractive.Yourself, y = Attractive.Others) + annotate("text", x = 10, y = 1, label = paste("Cor = ",round(cor.others.yourself.attractive$estimate,digits = 4) )) +
annotate("text", x = 9, y = 2, label = paste("T-paired = ",round(t.others.yourself.attractive$p.value, digits = 4) ))
plot.others.yourself.attractive

t.test(data.others.yourself$Ambitious.Yourself, data.others.yourself$Ambitious.Others, paired=TRUE)-> t.others.yourself.ambitious
t.others.yourself.ambitious
cor.test(data = data.others.yourself, ~Ambitious.Yourself+Ambitious.Others) -> cor.others.yourself.ambitious
cor.others.yourself.ambitious
plot.others.yourself.ambitious <- plot.others.yourself + aes(x = Ambitious.Yourself, y = Ambitious.Others) + annotate("text", x = 10, y = 1, label = paste("Cor = ",round(cor.others.yourself.ambitious$estimate,digits = 4) )) +
annotate("text", x = 9, y = 2, label = paste("T-paired = ",round(t.others.yourself.ambitious$p.value, digits = 4) ))
plot.others.yourself.ambitious

t.test(data.others.yourself$Sincere.Yourself, data.others.yourself$Sincere.Others, paired=TRUE)-> t.others.yourself.sincere
t.others.yourself.sincere
cor.test(data = data.others.yourself, ~Sincere.Yourself+Sincere.Others) -> cor.others.yourself.sincere
cor.others.yourself.sincere
plot.others.yourself.sincere <- plot.others.yourself + aes(x = Sincere.Yourself, y = Sincere.Others) + annotate("text", x = 10, y = 1, label = paste("Cor = ",round(cor.others.yourself.sincere$estimate,digits = 4) )) +
annotate("text", x = 9, y = 2, label = paste("T-paired = ",round(t.others.yourself.sincere$p.value, digits = 4) ))
plot.others.yourself.sincere

t.test(data.others.yourself$Intelligent.Yourself, data.others.yourself$Intelligent.Others, paired=TRUE)-> t.others.yourself.intelligent
t.others.yourself.intelligent
cor.test(data = data.others.yourself, ~Intelligent.Yourself+Intelligent.Others) -> cor.others.yourself.intelligent
cor.others.yourself.intelligent
plot.others.yourself.intelligent <- plot.others.yourself + aes(x = Intelligent.Yourself, y = Intelligent.Others) + annotate("text", x = 10, y = 1, label = paste("Cor = ",round(cor.others.yourself.intelligent$estimate,digits = 4) )) +
annotate("text", x = 9, y = 2, label = paste("T-paired = ",round(t.others.yourself.intelligent$p.value, digits = 4) ))
plot.others.yourself.intelligent

t.test(data.others.yourself$Fun.Yourself, data.others.yourself$Fun.Others, paired=TRUE)-> t.others.yourself.fun
t.others.yourself.fun
cor.test(data = data.others.yourself, ~Fun.Yourself+Fun.Others) -> cor.others.yourself.fun
cor.others.yourself.fun
plot.others.yourself.fun <- plot.others.yourself + aes(x = Fun.Yourself, y = Fun.Others) + annotate("text", x = 10, y = 1, label = paste("Cor = ",round(cor.others.yourself.fun$estimate,digits = 4) )) +
annotate("text", x = 9, y = 2, label = paste("T-paired = ",round(t.others.yourself.fun$p.value, digits = 4) ))
plot.others.yourself.fun


grid.arrange(plot.others.yourself.attractive, plot.others.yourself.ambitious, plot.others.yourself.sincere, plot.others.yourself.intelligent, plot.others.yourself.fun)

```

```{r are we same, echo = FALSE}
grid.arrange(plot.measure.yourself.median.all, plot.other.percieve.median.all, ncol = 1)
```

```{r market value, echo = FALSE}
data.partners.mean <-
  data.others.yourself.partners %>% 
  filter(!is.na(Attractive.Partners)&!is.na(Sincere.Partners)&!is.na(Intelligent.Partners)&!is.na(Fun.Partners)&!is.na(Ambitious.Partners)) %>%
  group_by(Gender) %>% 
  summarise(Attractive = mean(Attractive.Partners), Sincere = mean(Sincere.Partners), Intelligent = mean(Intelligent.Partners), Fun = mean(Fun.Partners), Ambitious = mean(Ambitious.Partners))

plot.partners.mean.all <- ggradar(plot.data = data.partners.mean , grid.mid = 5, grid.max = 10, legend.title = "Gender", grid.label.size =3,axis.label.size=4 )
plot.partners.mean.all

data.yourself.partners <-
   data.others.yourself.partners %>% 
  filter(!is.na(Attractive.Partners)&!is.na(Sincere.Partners)&!is.na(Intelligent.Partners)&!is.na(Fun.Partners)&!is.na(Ambitious.Partners))


cor.test(data = data.yourself.partners,  ~Attractive.Yourself+Attractive.Partners)
cor.test(data = subset(data.yourself.partners, Gender == 'Male'),  ~Attractive.Yourself+Attractive.Partners)
cor.test(data = subset(data.yourself.partners, Gender == 'Female'),  ~Attractive.Yourself+Attractive.Partners)

plot.yourself.partners <- ggplot(data = data.yourself.partners) + geom_point(position = "jitter") + facet_wrap(~Gender) + geom_smooth(method = lm) + scale_x_continuous(breaks = seq(0,10,2)) + scale_y_continuous(breaks = seq(0,10,2))

plot.yourself.partners.attractive <- plot.yourself.partners  + aes(x = Attractive.Yourself, y = Attractive.Partners)
plot.yourself.partners.ambitious <- plot.yourself.partners  + aes(x = Ambitious.Yourself, y = Ambitious.Partners)  
plot.yourself.partners.sincere <- plot.yourself.partners  + aes(x = Sincere.Yourself, y = Sincere.Partners)
plot.yourself.partners.intelligent <- plot.yourself.partners  + aes(x = Intelligent.Yourself, y = Intelligent.Partners)
plot.yourself.partners.fun <- plot.yourself.partners  + aes(x = Fun.Yourself, y = Fun.Partners)

grid.arrange(plot.yourself.partners.attractive, plot.yourself.partners.ambitious, plot.yourself.partners.sincere, plot.yourself.partners.intelligent, plot.yourself.partners.fun)

```
```{r most positive features}
data.score.yourself.partners.all <- data.others.yourself.partners
data.score.yourself.partners.males <- data.score.yourself.partners.all %>% filter(Gender == 'Male')
data.score.yourself.partners.females <- data.score.yourself.partners.all %>% filter(Gender == 'Female')

ggplot(data = data.score.yourself.partners.all) + geom_histogram(mapping = aes(x = PositiveResponseScore,fill = Gender), binwidth = 0.02) + facet_wrap(~Gender)

plot.score.partners <- ggplot(data = data.score.yourself.partners.all, mapping = aes(x = PositiveResponseScore, color = Gender))  + geom_point(alpha = 1/2) +   geom_smooth(method = lm, se = F)

plot.score.partners.attractive <- plot.score.partners + aes(y = Attractive.Partners)
plot.score.partners.ambitious <- plot.score.partners + aes(y = Ambitious.Partners)
plot.score.partners.sincere <- plot.score.partners + aes(y = Sincere.Partners)
plot.score.partners.intelligent <- plot.score.partners + aes(y = Intelligent.Partners)
plot.score.partners.fun <- plot.score.partners + aes(y = Fun.Partners)

grid.arrange(plot.score.partners.attractive, plot.score.partners.ambitious, plot.score.partners.sincere, plot.score.partners.intelligent, plot.score.partners.fun)

fit <- lm(PositiveResponseScore ~ Attractive.Partners + Fun.Partners, data = subset(data.score.yourself.partners.all, !is.na(Attractive.Yourself)))
summary(fit)
data.estimation <- data.others.yourself.partners %>% select(Attractive.Yourself, Fun.Yourself, PositiveResponseScore, Gender, Attractive.Partners)  %>% filter(!is.na(Attractive.Yourself))

names(data.estimation) <- c("Attractive.Partners", "Fun.Partners","Score.Actual","Gender","Attractive.Actual")
modelEstimate = predict(fit, newdata = data.estimation,
                        interval="prediction", level = .95)

data.estimation$Score.Estimated <- modelEstimate[,1]
ggplot(data = data.estimation, mapping = aes(x = Score.Actual, y = Score.Estimated,color = Gender)) + geom_point() + scale_y_continuous(breaks = seq(0,1,0.25))



#ggplot(data = data.score.yourself.partners.all, mapping = aes())


```
